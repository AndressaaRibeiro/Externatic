var e=require("@swup/plugin"),t=require("swup");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=/*#__PURE__*/s(e);module.exports=class extends r.default{constructor(e){super(),this.name="FormsPlugin",this.onKeyDown=e=>{this.specialKeys.hasOwnProperty(e.key)&&(this.specialKeys[e.key]=!0)},this.onKeyUp=e=>{this.specialKeys.hasOwnProperty(e.key)&&(this.specialKeys[e.key]=!1)},this.options={formSelector:"form[data-swup-form]",...e},this.specialKeys={Meta:!1,Control:!1,Shift:!1}}mount(){const e=this.swup;e._handlers.submitForm=[],e._handlers.openFormSubmitInNewTab=[],e.delegatedListeners.formSubmit=e.delegateEvent(this.options.formSelector,"submit",this.beforeFormSubmit.bind(this),{capture:!0}),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}unmount(){this.swup.delegatedListeners.formSubmit.destroy(),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}beforeFormSubmit(e){const t=this.swup;t.triggerEvent("submitForm",e);const s=e.target;if(this.isSpecialKeyPressed()){this.resetSpecialKeys(),t.triggerEvent("openFormSubmitInNewTab",e);const r=s.getAttribute("target");return s.setAttribute("target","_blank"),void s.addEventListener("submit",e=>{requestAnimationFrame(()=>{this.restorePreviousFormTarget(e.target,r)})},{once:!0})}this.submitForm(e)}restorePreviousFormTarget(e,t){t?e.setAttribute("target",t):e.removeAttribute("target")}submitForm(e){const s=this.swup;e.preventDefault();const r=e.target,i=new FormData(r),o=r.getAttribute("action")||t.getCurrentUrl(),n=(r.getAttribute("method")||"get").toUpperCase(),a=r.getAttribute("data-swup-transition");let{url:u,hash:m}=t.Location.fromUrl(o);m&&(s.scrollToElement=m),"GET"===n?(u=this.appendQueryParams(u,i),s.cache.remove(u),s.loadPage({url:u,customTransition:a})):(s.cache.remove(u),s.loadPage({url:u,method:n,data:i,customTransition:a}))}appendQueryParams(e,t){e=e.split("?")[0];const s=new URLSearchParams(t).toString();return s?`${e}?${s}`:e}isSpecialKeyPressed(){return Object.values(this.specialKeys).some(e=>e)}resetSpecialKeys(){for(const[e,t]of Object.entries(this.specialKeys))this.specialKeys[e]=!1}};
//# sourceMappingURL=index.cjs.map
